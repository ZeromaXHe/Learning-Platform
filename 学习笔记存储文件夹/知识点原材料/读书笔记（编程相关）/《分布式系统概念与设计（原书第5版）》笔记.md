# 第1章 分布式系统的特征

## 1.1 简介

我们定义的分布式系统有如下显著特征：

**并发**：在一个计算机网络中，执行并发程序是常见的行为。用户可以在各自的计算机上工作，在必要时共享诸如Web页面或文件之类的资源。系统处理共享资源的能力会随着网络资源（例如，计算机）的增加而提高。在本书的许多地方将描述有效部署这种额外能力的方法。对共享资源的并发执行程序的协调也是一个重要和重复提及的主题。

**缺乏全局时钟**：在程序需要协作时，它们通过交换消息来协调它们的动作。密切的协作通常取决于对程序动作发生的时间的共识。但是，事实证明，网络上的计算机与时钟同步所达到的准确性是有限的，即没有一个正确时间的全局概念。这是通信仅仅是通过网络发送消息这个事实带来的直接结果。定时问题和它们的解决方案将在第14章描述。

**故障独立性**：所有的计算机系统都可能出故障，一般由系统设计者负责为可能的故障设计结果。分布式系统可能以新的方式出现故障。网络故障导致网上互连的计算机的隔离，但这并不意味着它们停止运行，事实上，计算机上的程序不能够检测到网络是出现故障还是网络运行得比通常慢。类似的，计算机的故障或系统中程序的异常终止（崩溃），并不能马上使与它通信的其他组件了解。系统的每个组件会单独地出现故障，而其他组件还在运行。分布式系统的这个特征所带来的后果将是贯穿本书的一个反复提及的主题。

## 1.2 分布式系统的例子

### 1.2.1 Web搜索

Google，Web搜索技术上的市场领导者，在支持用于搜索（与其他Google应用和服务，如Google Earth）的复杂的分布式系统基础设施的设计上已做出了巨大的努力。它代表了计算历史上最大和最复杂的分布式系统设施之一。该基础设施最突出的亮点包括：

- 一个底层物理设施，它由超大数目的位于全世界多个数据中心的联网计算机组成；
- 一个分布式文件系统，支持超大文件，并根据搜索和其他Google应用的使用方式（特别是在文件中以快速而持久的速度读取）进行了深度优化；
- 一个相关的结构化分布式存储系统，它提供对超大数据集的快速访问；
- 一个锁服务，它提供诸如分布式加锁和协定等分布式系统功能；
- 一个编程模式，它支持对底层物理基础设施上的超大并行和分布式计算的管理。

### 1.2.2 大型多人在线游戏

针对大型多人在线游戏，提出了许多解决方案：

- 可能有点出人意料，最大的在线游戏EVE Online，采用了客户-服务器体系架构，在一个集中式服务器上维护了游戏世界状态的单个拷贝，供运行在玩家终端或其他设备上的客户程序访问。为了支持大量客户，服务器自身是一个复杂的实体，拥有由上百个计算机结点组成的集群结构（该客户-服务器方法在1.4节详细讨论，集群方法将在1.3.4节讨论）。
- 其他MMOG采用更多的分布式体系结构，宇宙被划分到大量（可能是超多）服务器上，这些服务器可能地理上分散部署。接着，用户基于当前的使用模式和到服务器的网络延迟（例如基于地理最近）被动态地分配到一个特定服务器。这种体系结构风格被EverQuest采用，它通过增加新的服务器，可自然地扩展。
- 大多数商业系统采用上述两个模型中的一个，但研究者现在也在寻找更极端的体系结构，即不基于客户-服务器原理而是基于对等技术采用完全分散的方法。采用对等技术，意味着每个参与者贡献（存储和处理）资源来容纳游戏。对对等解决方案的进一步研究将推迟到第2章和第10章。

### 1.2.3 金融交易

注意，此类系统的重点是对感兴趣数据项的通信和处理。感兴趣数据项在分布式系统中称为**事件**。这样的系统通常采用**分布式基于事件的系统**。

## 1.3 分布式系统的趋势

分布式系统正在经历巨大的变化，这可追溯到一系列有影响力的趋势：

- 出现了泛在联网技术；
- 出现了无处不在计算，它伴随着分布式系统中支持用户移动性的意愿；
- 对多媒体设备的需求增加；
- 把分布式系统作为一个设施。

### 1.3.1 泛在联网和现代互联网

最终结果是联网已成为一个泛在的资源，设备可以在任何时间、任何地方被连接（如果愿意）。

互联网和其支持的服务的实现，使得必须开发实用解决方案来解决分布式系统中的许多问题（包括在1.5节中定义的大多数问题）。

### 1.3.2 移动和无处不在计算

设备小型化和无线网络方面的技术进步已经逐步使得小型和便携式计算设备集成到分布式系统中。

这些设备大部分具有可携带性，再加上它们可以在不同地方方便地连接到网络的能力，使得**移动计算**成为可能。移动计算是指用户在移动或访问某个非常规环境时执行计算任务的性能。

**无处不在计算**是指在对用户的物理环境（包括家庭、办公室和其他自然环境）中存在的多个小型、便宜的计算设备的利用。

利用适当的系统基础设施，用户能在其访问地用他们携带的设备完成一些简单的任务。原则上，用户可以利用无线LAN或有线的以太网链接从笔记本电脑上把文件发送到同一台打印机。

这个场景说明了支持**自发互操作**的需求，依靠自发互操作，设备之间的关联被例行地创建和拆除，定位和使用所访问地的设备（如打印机）是一个这方面的例子。这种情况下的最大挑战是让互操作快速和方便（即自发），即使用户可能在一个他们以前从来没有访问过的环境。这意味着，要让访问者的设备在访问地的网络上通信，并将设备与合适的本地设备相关联——这个过程称为**服务发现**。

### 1.3.3 分布式多媒体系统

人们可以期望分布式多媒体系统支持离散类型媒体（如图片或正文消息）的存储、传输和展示。分布式多媒体系统应该能对连续类型媒体（如音频和视频）完成相同的功能，即它应该能存储和定位音频或视频文件，并通过网络传输它们（可能需要以实时的方式，因为流来自摄像机），从而能向用户展示多种媒体类型，以及在一组用户中共享多种类型的媒体。

**网络播放**（webcasting）是分布式多媒体技术的应用。

### 1.3.4 把分布式计算作为一个公共设施

随着分布式系统基础设施的不断成熟，不少公司在推广这样的观点：把分布式资源看成一个商品或公共设施，把分布式资源和其他公共设施（例如水或电）进行类比。采用这个模型，资源通过合适的服务提供者提供，能被最终用户有效地租赁而不是拥有。这种模型可以应用到物理资源和更多的逻辑服务上。

关于计算作为公共设施，术语**云计算**（cloud computing）被用来刻画其前景。云被定义成一组基于互联网的应用，并且足以满足大多数用户需求的存储和计算服务的集合，这使得用户能大部分或全部免除本地数据存储和应用软件的使用。

**网格计算**也能被看成一种云计算。大量的术语是同义的，偶尔定义得不清楚，但网格计算通常被看成是云计算这种更通用模式的先驱，它只是偏重于支持科学计算。

## 1.4 关注资源共享



## 1.5 挑战

### 1.5.1 异构性

互联网使得用户能在大量异构计算机和网络上访问应用程序。下面这些均存在异构性（即存在多样性和差别）：

- 网络；
- 计算机硬件；
- 操作系统；
- 编程语言；
- 由不同开发者完成的软件实现。

虽然，互联网由多种不同种类的网络组成，但因为所有连接到互联网的计算机都使用互联网协议来相互通信，所以这些不同网络的区别被屏蔽了。例如，连接在以太网中的计算机要在以太网上实现互联网协议，而在另一种网络上的计算机需要在该网络上实现互联网协议。第3章将解释互联网协议如何在多种不同的网络上实现。

整型等数据类型在不同种类的硬件上可以有不同的表示方法。例如，整数的字节顺序就有两种表示方法。如果要在不同硬件上运行的两个程序之间交换消息，那么就要处理它们在表示上的不同。

虽然互联网上所有的计算机的操作系统均需要包含互联网协议的实现，但可以不为这些协议提供相同的应用编程接口。例如，UNIX中消息交换的调用与Windows中的调用是不一样的。

不同的编程语言使用不同的方式表示字符和数据结构（如数组和记录）。如果想让用不同语言编写的程序能够相互通信，那么必须解决这些差异。

不同开发者只有使用公共标准，他们编写的程序才能相互通信。例如，网络通信和消息中的基本数据项和数据结构的表示均要使用公共标准。所以，要制订和采用公共标准，就像互联网协议一样。

**中间件** 术语**中间件**是指一个软件层，它提供了一个编程抽象，同时屏蔽了底层网络、硬件、操作系统和编程语言的异构性。

除了解决异构性问题外，中间件为服务器和分布式应用的程序员提供了一致的计算模型。这些模型包括远程对象调用、远程事件通知、远程SQL访问和分布式事务处理。

**异构性和移动代码** 术语**移动代码**指能从一台计算机发送到另一台计算机，并且目的计算机上运行的代码，Java applet是一个例子。

### 1.5.2 开放性

计算机系统的开放性是决定能否以不同的方式被扩展和重新实现的特征。分布式系统的开放性主要取决于新的资源共享服务能被增加和供多种客户程序使用的程度。

除非软件开发者能获得系统组件的关键软件接口的规约和文档，否则无法实现开放性。一句话，**发布**关键接口。

互联网协议的设计者引入了一系列称为“征求意见文档”（Request For Comments，RFC）的文档，每个文档有一个编号。RFC不是唯一的发布方式，例如，万维网联盟（World Wide Web Consortium，W3C）开发和发布了与Web工作相关的标准。

按这种方式支持资源共享的系统之所以称为**开放的分布式系统**，主要是强调它们是可扩展的。它们可通过在网络中增加计算机实现在硬件层面的扩展，通过引入新的服务、重新实现旧的服务实现在软件层次上的扩展，最终使得应用程序能共享资源。

### 1.5.3 安全性

分布式系统中维护和使用的众多信息资源对用户具有很高的内在价值，因此它们的安全相当重要。信息资源的安全性包括三个部分：机密性（防止泄漏给未授权的个人）、完整性（防止被改变或被破坏）、可用性（防止对访问资源的手段的干扰）。

下列两个安全方面所面临的挑战目前还没有圆满解决：

**拒绝服务攻击**

**移动代码的安全性**

### 1.5.4 可伸缩性

分布式系统可在不同的规模（从小型企业内部网到互联网）下有效且高效地运转。如果资源数量和用户数量激增，系统仍能保持其有效性，那么该系统就称为**可伸缩的**。

可伸缩分布式系统的设计面临下列挑战：

**控制物理资源的开销**：当对资源的需求增加时，应该可以花费合理的开销扩展系统以满足要求。

**控制性能损失**：如果数据集的大小与系统中的用户或资源数量成正比，设想一下这些数据的管理。采用层次结构的算法其伸缩性要好于使用线性结构的算法。但即使使用层次结构，数量的增加仍将导致一些性能上的损失，即访问有层次地结构化数据的时间是O(log n)，当n是数据集的大小时，对一个可伸缩的系统，最大的性能损失莫过于此。

**防止软件资源用尽**：用做互联网（IP）地址（互联网上的计算机地址）的数字是缺乏伸缩性的一个例子。

**避免性能瓶颈**：通常，算法应该是分散型，以避免性能瓶颈。

### 1.5.5 故障处理

分布式系统的故障是部分的，也就是说，有些组件出了故障而有些组件运行正常。因此故障的处理相当困难。本书将讨论下列处理故障的技术：

**检测故障**：有些故障能被检测到。例如，校验和可用于检测消息或文件中出错的数据。第2章将解释其他一些故障（例如，互联网上一台远程服务器的崩溃）是很难甚至不可能被检测到。面临的挑战是如何在有故障出现的情况下进行管理，这些故障不能被检测到但可以被猜到。

**掩盖故障**：有些被检测到的故障能被隐藏起来或降低它的严重程度。下面是隐藏故障的两个例子：

1）消息在不能到达时进行重传。

2）将文件数据写入两个磁盘，如果一个磁盘损坏，那么另一个磁盘的数据仍是正确的。

降低故障严重程度的例子是丢掉被损坏的消息，这样，该消息可以被重传。读者可能意识到，隐藏故障的技术不能保证在最坏情况下有效。例如，第二个磁盘上的数据可能也坏了，或信息无论怎样重传都不能在合理的时间内到达。

**容错**：服务的客户能被设计成容错的，这通常也涉及用户要容忍错误。

**故障恢复**：恢复设计软件的设计，以便在服务器崩溃后，永久数据的状态能够被恢复或“回滚”。

**冗余**：利用冗余组件，服务可以实现容错。

### 1.5.6 并发性

在分布式系统中，服务和应用均提供可被客户共享的资源。因此，可能有几个客户同时视图访问一个共享资源的情况。

在分布式系统中，代表共享资源的任何一个对象必须负责确保它在并发环境中操作正确，这不仅适用于服务器，也适用于应用中的对象。因此，持有未打算用于分布式系统的对象实现的程序员必须做一些事情，使得对象在并发环境中能安全使用。

### 1.5.7 透明性

透明性被定义成为对用户和应用程序员屏蔽分布式系统的组件的分离性，使系统被认为一个整体，而不是独立组件的集合。透明性的含义对系统软件的设计有重大的影响。

**访问透明性**：用相同的操作访问本地资源和远程资源。

**位置透明性**：不需要知道资源的物理或网络位置就能访问它们。

**并发透明性**：几个进程能够并发地使用共享资源进行操作且互不干扰。

**复制透明性**：使用资源的多个实例提升可靠性和性能，而用户和应用程序员无需知道副本的相关信息。

**故障透明性**：屏蔽错误，不论是硬件组件故障还是软件组件故障，用户和应用程序都能够完成它们的任务。

**移动透明性**：资源和客户能够在系统内移动而不会影响用户或程序的操作。

**性能透明性**：当负载变化时，系统能被重新配置以提高性能。

**伸缩透明性**：系统和应用能够进行扩展而不改变系统结构或应用算法。

最重要的两个透明性是访问透明性和位置透明性，它们的有无对分布式资源的利用有很大影响。有时它们统一称为**网络**透明性。

### 1.5.8 服务质量

一旦提供给用户他们要求的服务的功能，例如在一个分布式系统中的文件服务，我们就能继续探询所提供的服务质量。系统的主要的非功能特性，即影响客户和用户体验的服务质量是**可靠性**、**安全性**和**性能**。满足变化的系统配置和资源可用性的**适应性**已被公认为服务质量的一个重要方面。

可靠性和安全性问题在设计大多数计算机系统时是关键的。服务质量的性能方面源于及时性和计算吞吐量，但它已被重定义成满足及时性保证的能力。

## 1.6 实例研究：万维网

# 第2章 系统模型

